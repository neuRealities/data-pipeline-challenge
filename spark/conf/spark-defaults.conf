# ------------------------------------------------------------
# Spark Defaults (Full configuration for Delta + Kafka + MinIO)
# ------------------------------------------------------------

# === Core JARs ===
spark.jars /opt/extra-jars/delta-spark_2.12-3.3.0.jar,\
/opt/extra-jars/delta-storage-3.3.0.jar,\
/opt/extra-jars/spark-sql-kafka-0-10_2.12-3.5.0.jar,\
/opt/extra-jars/spark-token-provider-kafka-0-10_2.12-3.5.0.jar,\
/opt/extra-jars/kafka-clients-3.5.0.jar,\
/opt/extra-jars/hadoop-aws-3.3.4.jar,\
/opt/extra-jars/aws-java-sdk-bundle-1.12.300.jar,\
/opt/extra-jars/commons-pool2-2.11.1.jar

# === Delta Lake ===
spark.sql.extensions io.delta.sql.DeltaSparkSessionExtension
spark.sql.catalog.spark_catalog org.apache.spark.sql.delta.catalog.DeltaCatalog

# === MinIO (S3A connector) ===
spark.hadoop.fs.s3a.endpoint http://minio:9000
spark.hadoop.fs.s3a.access.key minioadmin
spark.hadoop.fs.s3a.secret.key minioadmin
spark.hadoop.fs.s3a.path.style.access true
spark.hadoop.fs.s3a.impl org.apache.hadoop.fs.s3a.S3AFileSystem
# Optional tuning
spark.hadoop.fs.s3a.connection.ssl.enabled false
spark.hadoop.fs.s3a.attempts.maximum 3
spark.hadoop.fs.s3a.connection.establish.timeout 5000
spark.hadoop.fs.s3a.connection.timeout 10000

# === Delta retention / cleanup ===
spark.databricks.delta.retentionDurationCheck.enabled false

# === Structured Streaming safety ===
spark.sql.streaming.schemaInference true
# fallback checkpoint dir (jobs should still override!)
spark.sql.streaming.checkpointLocation /tmp/spark-checkpoints

# === Resource tuning ===
spark.sql.shuffle.partitions 4
spark.default.parallelism 4

